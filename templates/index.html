<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <title>대동0ㅕ지도</title>
    <style>
        * {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .nav-link {
            font-weight: bold;
        }

        #mapwrap{position:relative;overflow:hidden;}
        .category, .category *{margin:0;padding:0;color:#000;}
        .category {position:absolute;overflow:hidden;top:10px;left:10px;width:400px;height:60px;z-index:10;border:1px solid black;font-family:'Malgun Gothic','맑은 고딕',sans-serif;font-size:12px;text-align:center;background-color:#fff;}
        .category .menu_selected {background:#FF5F4A;color:#fff;border-left:1px solid #915B2F;border-right:1px solid #915B2F;margin:0 -1px;}
        .category li{list-style:none;float:left;width:80px;height:60px;padding-top:5px;cursor:pointer;}
        .category .ico_comm {display:block;margin:0 auto 2px;width:22px;height:26px;background:url('https://i.ibb.co/qFyCPzK/mapicon.png') no-repeat;}
        .category .ico_all {background-position:-10px 0;}
        .category .ico_cafe {background-position:-10px -36px;}
        .category .ico_shop {background-position:-10px -72px;}
        .category .ico_household {background-position:-10px -108px;}
        .category .ico_etc {background-position:-10px -144px;}

        .wrap {position: absolute;left: 0;bottom: 30px;width: 240px;height: 132px;margin-left: -120px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
        .wrap * {padding: 0;margin: 0;}
        .wrap .info {width: 240px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
        .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
        .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 14px;font-weight: bold;}
        .info .close {position: absolute;top: 8px;right: 10px;color: #888;width: 15px;height: 15px;background: url('https://i.postimg.cc/Cxz6bGfg/close.png');}
        .info .close:hover {cursor: pointer;}
        .info .body {position: relative;overflow: hidden;}
        .info .desc {position: relative;margin: 13px 0 0 13px;height: 75px;}
        .desc .ellipsis {font-size: 14px; overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
        .desc .jibun {font-size: 11px;color: #888;margin-top: -2px;}
        .info:after {content: '';position: absolute;margin-left: -12px;left: 50%;bottom: 0;width: 22px;height: 12px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')}
        .info .link {font-size: 12px; color: #5085BB;}
    </style>
</head>
<body>
    <!-- HTML for Horizontal Menu -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a href="/">
                <img src={{ url_for('static', filename='images/logo.png') }} alt="logo">
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/board">게시판</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About Us</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div id="mapwrap">
    <!-- 지도가 표시될 div -->
    <div id="map" style="width:100%;height:1000px;"></div>
    <!-- 지도 위에 표시될 마커 카테고리 -->
        <div class="category">
            <ul>
                <li id="allMenu" onclick="changeMarker('all')">
                    <span class="ico_comm ico_all"></span>
                    전체
                </li>
                <li id="cafeMenu" onclick="changeMarker('cafe')">
                    <span class="ico_comm ico_cafe"></span>
                    카페/식당
                </li>
                <li id="shopMenu" onclick="changeMarker('shop')">
                    <span class="ico_comm ico_shop"></span>
                    리필샵
                </li>
                <li id="householdMenu" onclick="changeMarker('household')">
                    <span class="ico_comm ico_household"></span>
                    생필품점
                </li>
                <li id="etcMenu" onclick="changeMarker('etc')">
                    <span class="ico_comm ico_etc"></span>
                    기타
                </li>
            </ul>
        </div>
    </div>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9b16bb18fadb4010e3a075c836c12861"></script>
    <script>

       /* function show_order() {
            $.ajax({
                type: 'GET',
                url: '/',
                data: {},
                success: function (response) {
                    let rows = response['shops']
                    for (let i = 0; i < rows.length; i++) {
                        let Latitude = rows[i]['latitude']
                        let Longitude = rows[i]['longitude']

                        console.log(Latitude, Longitude)
                    }
                }
            });
        }*/

    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(37.55324494834374, 126.97268075540136), // 지도의 중심좌표
            level: 7 // 지도의 확대 레벨
        };

    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다


    // 카페식당 마커가 표시될 좌표 배열입니다
    var cafePositions = [];
        function show_cafe() {
            $.ajax({
                type: 'GET',
                url: '/getdatacafe',
                data: {},
                success: function (response) {
                    let rows = response['cafe']
                    console.log(rows);
                    for (let i = 0; i < rows.length; i++) {
                        let temp = rows[i]
                        let Latitude = temp['Latitude']
                        let Longitude = temp['Longitude']
                        //console.log(Latitude,Longitude);
                        cafePositions.push(new kakao.maps.LatLng(Latitude, Longitude));
                        //console.log(cafePositions);
                    }
                    refreshMap();
                }
            })
        };
        show_cafe()

    var shopPositions = [];
        function show_shop() {
            $.ajax({
                type: 'GET',
                url: '/getdatarefill',
                data: {},
                success: function (response) {
                    let rows = response['refill']
                    console.log(rows);
                    for (let i = 0; i < rows.length; i++) {
                        let temp = rows[i]
                        let Latitude = temp['Latitude']
                        let Longitude = temp['Longitude']
                        //console.log(Latitude,Longitude);
                        shopPositions.push(new kakao.maps.LatLng(Latitude, Longitude));
                        //console.log(cafePositions);
                    }
                    refreshMap();
                }
            })
        };
        show_shop()

    var householdPositions = [];
        function show_household() {
            $.ajax({
                type: 'GET',
                url: '/getdatadaily',
                data: {},
                success: function (response) {
                    let rows = response['daily']
                    console.log(rows);
                    for (let i = 0; i < rows.length; i++) {
                        let temp = rows[i]
                        let Latitude = temp['Latitude']
                        let Longitude = temp['Longitude']
                        //console.log(Latitude,Longitude);
                        householdPositions.push(new kakao.maps.LatLng(Latitude, Longitude));
                        //console.log(cafePositions);
                    }
                    refreshMap();
                }
            })
        };
        show_household()

    var etcPositions = [];
        function show_etc() {
            $.ajax({
                type: 'GET',
                url: '/getdataetc',
                data: {},
                success: function (response) {
                    let rows = response['etc']
                    console.log(rows);
                    for (let i = 0; i < rows.length; i++) {
                        let temp = rows[i]
                        let Latitude = temp['Latitude']
                        let Longitude = temp['Longitude']
                        //console.log(Latitude,Longitude);
                        etcPositions.push(new kakao.maps.LatLng(Latitude, Longitude));
                        //console.log(cafePositions);
                    }
                    refreshMap();
                }
            })
        };
        show_etc()
    /*
    var cafePositions = [
        new kakao.maps.LatLng(37.5623319, 126.8403025),
        new kakao.maps.LatLng(37.5810482, 127.0513881)
    ]

    // 리필샵 마커가 표시될 좌표 배열입니다
    var shopPositions = [
        new kakao.maps.LatLng(37.497535461505684, 127.02948149502778),
        new kakao.maps.LatLng(37.49671536281186, 127.03020491448352)
    ];

    // 생필품점 마커가 표시될 좌표 배열입니다
    var householdPositions = [
        new kakao.maps.LatLng(37.49966168796031, 127.03007039430118),
        new kakao.maps.LatLng(37.499463762912974, 127.0288828824399)
    ];

    var etcPositions = [
        new kakao.maps.LatLng(37.49721078809879, 127.03070268983136),
        new kakao.maps.LatLng(37.49840222163074, 127.02110207359988)
    ];
*/
    var markerImageSrc = 'https://i.ibb.co/hMrXPNS/mapicon.png';  // 마커이미지의 주소입니다. 스프라이트 이미지 입니다
        cafeMarkers = []; // 카페식당 마커 객체를 가지고 있을 배열입니다
        shopMarkers = []; // 리필샵 마커 객체를 가지고 있을 배열입니다
        householdMarkers = []; // 생필품점 마커 객체를 가지고 있을 배열입니다
        etcMarkers = []; // 기타 마커 객체를 가지고 있을 배열입니다

    refreshMap();
    function refreshMap() {
        createCafeMarkers(); // 카페식당 마커를 생성하고 카페식당 마커 배열에 추가합니다
        createShopMarkers(); // 리필샵 마커를 생성하고 리필샵 마커 배열에 추가합니다
        createHouseholdMarkers(); // 생필품점 마커를 생성하고 생필품점 마커 배열에 추가합니다
        createEtcMarkers(); // 기타 마커를 생성하고 기타 마커 배열에 추가합니다

        changeMarker('all'); // 지도에 전체 마커가 보이도록 설정합니다
    }

    // 마커이미지의 주소와, 크기, 옵션으로 마커 이미지를 생성하여 리턴하는 함수입니다
    function createMarkerImage(src, size, options) {
        var markerImage = new kakao.maps.MarkerImage(src, size, options);
        return markerImage;
    }

    // 좌표와 마커이미지를 받아 마커를 생성하여 리턴하는 함수입니다
    function createMarker(position, image) {
        var marker = new kakao.maps.Marker({
            position: position,
            image: image
        });

        return marker;
    }

    // 카페식당 마커를 생성하고 카페식당 마커 배열에 추가하는 함수입니다
    function createCafeMarkers() {
        for (var i = 0; i < cafePositions.length; i++) {

            var imageSize = new kakao.maps.Size(19, 26),
                imageOptions = {
                    spriteOrigin: new kakao.maps.Point(10, 0),
                    spriteSize: new kakao.maps.Size(36, 134)
                };

            // 마커이미지와 마커를 생성합니다
            var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                marker = createMarker(cafePositions[i], markerImage);

            // 생성된 마커를 카페식당 마커 배열에 추가합니다
            cafeMarkers.push(marker);
        }
    }

    // 카페식당 마커들의 지도 표시 여부를 설정하는 함수입니다
    function setCafeMarkers(map) {
        for (var i = 0; i < cafeMarkers.length; i++) {
            cafeMarkers[i].setMap(map);
            createOverlay(cafeMarkers[i] , map);
        }
    }

    // 리필샵 마커를 생성하고 리필샵 마커 배열에 추가하는 함수입니다
    function createShopMarkers() {
        for (var i = 0; i < shopPositions.length; i++) {

            var imageSize = new kakao.maps.Size(19, 26),
                imageOptions = {
                    spriteOrigin: new kakao.maps.Point(10, 36),
                    spriteSize: new kakao.maps.Size(36, 134)
                };

            // 마커이미지와 마커를 생성합니다
            var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                marker = createMarker(shopPositions[i], markerImage);

            // 생성된 마커를 리필샵 마커 배열에 추가합니다
            shopMarkers.push(marker);
        }
    }

    // 리필샵 마커들의 지도 표시 여부를 설정하는 함수입니다
    function setShopMarkers(map) {
        for (var i = 0; i < shopMarkers.length; i++) {
            shopMarkers[i].setMap(map);
            createOverlay(shopMarkers[i] , map);
        }
    }

    // 생필품점 마커를 생성하고 생필품점 마커 배열에 추가하는 함수입니다
    function createHouseholdMarkers() {
        for (var i = 0; i < householdPositions.length; i++) {

            var imageSize = new kakao.maps.Size(19, 26),
                imageOptions = {
                    spriteOrigin: new kakao.maps.Point(10, 72),
                    spriteSize: new kakao.maps.Size(36, 134)
                };

            // 마커이미지와 마커를 생성합니다
            var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                marker = createMarker(householdPositions[i], markerImage);

            // 생성된 마커를 생필품점 마커 배열에 추가합니다
            householdMarkers.push(marker);
        }
    }

    // 생필품점 마커들의 지도 표시 여부를 설정하는 함수입니다
    function setHouseholdMarkers(map) {
        for (var i = 0; i < householdMarkers.length; i++) {
            householdMarkers[i].setMap(map);
            createOverlay(householdMarkers[i] , map);
        }
    }

    // 기타 마커를 생성하고 생필품점 마커 배열에 추가하는 함수입니다
    function createEtcMarkers() {
        for (var i = 0; i < etcPositions.length; i++) {

            var imageSize = new kakao.maps.Size(19, 26),
                imageOptions = {
                    spriteOrigin: new kakao.maps.Point(10, 108),
                    spriteSize: new kakao.maps.Size(36, 134)
                };

            // 마커이미지와 마커를 생성합니다
            var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                marker = createMarker(etcPositions[i], markerImage);

            // 생성된 마커를 생필품점 마커 배열에 추가합니다
            etcMarkers.push(marker);
        }
    }

    // 기타 마커들의 지도 표시 여부를 설정하는 함수입니다
    function setEtcMarkers(map) {
        for (var i = 0; i < etcMarkers.length; i++) {
            etcMarkers[i].setMap(map);
            createOverlay(etcMarkers[i] , map);
        }
    }

    // 카테고리를 클릭했을 때 type에 따라 카테고리의 스타일과 지도에 표시되는 마커를 변경합니다
    function changeMarker(type){
        var allMenu = document.getElementById('allMenu');
        var cafeMenu = document.getElementById('cafeMenu');
        var shopMenu = document.getElementById('shopMenu');
        var householdMenu = document.getElementById('householdMenu');
        var etcMenu = document.getElementById('etcMenu');

        // 전체 카테고리가 클릭됐을 때
        if (type === 'all') {
            // 전체 카테고리를 선택된 스타일로 변경하고
            allMenu.className = 'menu_selected';
            // 나머지 카테고리는 선택되지 않은 스타일로 바꿉니다
            cafeMenu.className = '';
            shopMenu.className = '';
            householdMenu.className = '';
            etcMenu.className = '';

            // 전체 마커가 지도에 표시하도록 설정합니다
            setCafeMarkers(map);
            setShopMarkers(map);
            setHouseholdMarkers(map);
            setEtcMarkers(map);

        } else if (type === 'cafe') {

            // 카페식당 카테고리를 선택된 스타일로 변경하고
            cafeMenu.className = 'menu_selected';

            // 나머지 카테고리는 선택되지 않은 스타일로 바꿉니다
            allMenu.className = '';
            shopMenu.className = '';
            householdMenu.className = '';
            etcMenu.className = '';

            // 카페식당 마커들만 지도에 표시하도록 설정합니다
            setCafeMarkers(map);
            setShopMarkers(null);
            setHouseholdMarkers(null);
            setEtcMarkers(null);

        } else if (type === 'shop') { // 리필샵 카테고리가 클릭됐을 때

            // 리필샵 카테고리를 선택된 스타일로 변경하고
            shopMenu.className = 'menu_selected';

            // 나머지 카테고리는 선택되지 않은 스타일로 바꿉니다
            allMenu.className = '';
            cafeMenu.className = '';
            householdMenu.className = '';
            etcMenu.className = '';

            // 리필샵 마커들만 지도에 표시하도록 설정합니다
            setCafeMarkers(null);
            setShopMarkers(map);
            setHouseholdMarkers(null);
            setEtcMarkers(null);

        } else if (type === 'household') { // 생필품점 카테고리가 클릭됐을 때

            // 생필품점 카테고리를 선택된 스타일로 변경하고
            householdMenu.className = 'menu_selected';

            // 나머지 카테고리는 선택되지 않은 스타일로 바꿉니다
            allMenu.className = '';
            cafeMenu.className = '';
            shopMenu.className = '';
            etcMenu.className = '';

            // 생필품점 마커들만 지도에 표시하도록 설정합니다
            setCafeMarkers(null);
            setShopMarkers(null);
            setHouseholdMarkers(map);
            setEtcMarkers(null);

        }  else if (type === 'etc') { // 기타 카테고리가 클릭됐을 때

            // 기타 카테고리를 선택된 스타일로 변경하고
            etcMenu.className = 'menu_selected';

            // 나머지 카테고리는 선택되지 않은 스타일로 바꿉니다
            allMenu.className = '';
            cafeMenu.className = '';
            shopMenu.className = '';
            householdMenu.className = '';

            // 기타 마커들만 지도에 표시하도록 설정합니다
            setCafeMarkers(null);
            setShopMarkers(null);
            setHouseholdMarkers(null);
            setEtcMarkers(map);
        }
    }

    // var count = 0;

    function createOverlay(markers , map){
        // 커스텀 오버레이를 생성합니다.
        // count++;
        console.log(markers);
        var overlay = new kakao.maps.CustomOverlay({
            position: markers.getPosition()
        });

        var wrap = document.createElement('div');
        wrap.className = 'wrap';
        var info = document.createElement('div');
        info.className = 'info';
        var title = document.createElement('div');
        title.className = 'title';
        /*
        if (isNaN(count)) { // 값이 없어서 NaN값이 나올 경우
         count = 0;
        }
         */
        var subject = '카카오 스페이스닷원' // + count;

        title.appendChild(document.createTextNode(subject));
        var closeDiv = document.createElement('div');
        closeDiv.className = 'close';
        closeDiv.onclick = function () {
            overlay.setMap(null);
        }

        var body = document.createElement('body');
        body.classname = "body";
        var desc = document.createElement('div');
        desc.className = 'desc';

        var ellipsis = document.createElement('div');
        ellipsis.className = 'ellipsis';
        ellipsis.innerHTML = '제주특별자치도 제주시 첨단로 242';

        var jibunEllipsis = document.createElement('div');
        jibunEllipsis.className = 'jibun ellipsis';
        jibunEllipsis.innerHTML = '(우) 63309 (지번) 영평동 2181';

        var link = document.createElement('div');
        var aTag = document.createElement('a');
        aTag.className = 'link';
        aTag.href = 'https://www.kakaocorp.com/main';
        aTag.target = '_blank';
        aTag.appendChild(document.createTextNode('홈페이지'));
        link.append(aTag);
        title.append(closeDiv);
        desc.append(ellipsis);
        desc.append(jibunEllipsis);
        desc.append(link);
        body.append(desc);
        info.append(title);
        info.append(body);
        wrap.append(info);

        overlay.setContent(wrap);

        // 마커를 클릭했을 때 커스텀 오버레이를 표시합니다
        kakao.maps.event.addListener(markers, 'click', function () {
            overlay.setMap(map);
        });

    }
/*
        function show_info(){
            $.ajax({
                type: "GET",
                url: "/wastemap",
                data: {},
                success: function (response) {
                    let rows = response['buckets']
                    for (let i = 0; i < rows.length; i++) {
                        let Name = rows[i]['name']
                        let Category = rows[i]['category']
                        let Address = rows[i]['address']

                        let temp_html = ``
                        if (done == 0) {
                            temp_html = `<li>
                                            <h2>✅ ${bucket}</h2>
                                            <button onClick="done_bucket(${num})" type="button" className="btn btn-outline-primary">완료!
                                            </button>
                                        </li>`
                        } else {
                            temp_html = `<li>
                                            <h2 class="done">✅ ${bucket}</h2>
                                        </li>`
                        }
                        $('#bucket-list').append(temp_html)
                    }
                }
            });
        }
*/

    </script>
</body>
</html>